{"version":3,"names":["User","require","bcrypt","encode","decode","dotenv","config","authController","creatAccount","req","res","Fullname","age","email","password","body","hash","hashSync","checkUser","findOne","user","status","json","message","createDate","create","role","data","error","Login","findUser","dbEmail","dbPassword","dbRole","decreptedPassword","compare","console","log","token","decodeToken","emailfromtoken","stastus","update","userupdate","_id","params","id","save","send","module","exports"],"sourceRoot":"E:\\andela\\New Andela\\node_mongo_tutorial\\src\\controllers\\","sources":["authController.js"],"sourcesContent":["const User =require(\"../models/users\");\r\nconst bcrypt =require(\"bcrypt\");\r\nconst {encode, decode} =require(\"../helper/jwtTokenize\")\r\nconst dotenv=require(\"dotenv\");\r\n\r\ndotenv.config();\r\nclass authController{\r\n    static async creatAccount(req, res){\r\n        try {\r\n            const {Fullname,age,email,password}=req.body;\r\n            // console.log(\"email:\",email);\r\n            const hash = await bcrypt.hashSync(password, 10);\r\n            const checkUser = await User.findOne({email});\r\n            req.user=checkUser\r\n            // console.log(\"this:\",checkUser)\r\n            if(req.user){\r\n                return res.status(400).json({\r\n                    status:400,\r\n                    message:\"Email already exist\"\r\n                    \r\n                })\r\n            }\r\n            else{\r\n                const createDate = await User.create({\r\n                 Fullname,\r\n                 age,\r\n                 email,\r\n                 role:\"user\",\r\n                 password:hash\r\n                });\r\n               return res.status(200).json({\r\n                    status: 200,\r\n                    message: \"Account created\",\r\n                    data:createDate\r\n                })\r\n\r\n            }\r\n        } catch (error) {\r\n            res.status(500).json({\r\n                status:500,\r\n                message:\"server problem:\" + error.message\r\n            })\r\n            \r\n        }\r\n    }\r\n\r\n    static async Login(req, res){\r\n        try {\r\n            const {email,password}=req.body\r\n            const findUser = await User.findOne({email})\r\n            req.user=findUser\r\n            if(!findUser){\r\n                res.status(404).json({\r\n                    status: 404,\r\n                    message:\"Account don't exit\"\r\n                })\r\n            }\r\n            else{\r\n                const dbEmail = req.user.email\r\n                const dbPassword = req.user.password\r\n                const dbRole= req.user.role\r\n                const decreptedPassword = await bcrypt.compare(password, dbPassword)\r\n                console.log(\"dec\",decreptedPassword)\r\n                console.log(dbEmail,dbPassword);\r\n                if(dbEmail == email){\r\n                    if(decreptedPassword){\r\n                        const token=await encode({\r\n                            email,\r\n                            dbRole   \r\n                        });\r\n                        const decodeToken = await decode(token);\r\n                        const role = decodeToken.dbRole\r\n                        const emailfromtoken =decodeToken.email\r\n                       \r\n                       return res.status(200).json({\r\n                            stastus: 200,\r\n                            message: \"Login succefull\",\r\n                            data:{\r\n                                role,\r\n                                emailfromtoken,\r\n                                token\r\n                            }\r\n                        })\r\n                    }else{\r\n                        res.status(400).json({\r\n                            stastus: 400,\r\n                            message:\"Wrong Password\"\r\n                        })\r\n                    }\r\n                }else{\r\n                    res.status(400).json({\r\n                        stastus: 400,\r\n                        message:\"Wrong Email\"\r\n                    })\r\n                }\r\n            }\r\n            \r\n        } catch (error) {\r\n            res.status(500).json({\r\n                stastus: 500,\r\n                message:\"server problem\" +error.message\r\n            })\r\n        }\r\n    }\r\n\r\n    static async update(req,res){\r\n        try {\r\n            // const hash = await bcrypt.hashSync(password, 10);\r\n            const userupdate = await User.findOne({ _id: req.params.id })\r\n            \r\n            if (req.body.Fullname) {\r\n                userupdate.Fullname = req.body.Fullname\r\n            }\r\n    \r\n            if (req.body.age) {\r\n                userupdate.age = req.body.age\r\n            }\r\n            if (req.body.email) {\r\n                userupdate.email = req.body.email\r\n            }\r\n            if (req.body.password) {\r\n                userupdate.password = req.body.password\r\n                \r\n            }\r\n           \r\n\r\n            await userupdate.save()\r\n            res.send( res.status(200).json({\r\n                status:200,\r\n                message:\"Account Updated Successfull\",\r\n                data: userupdate\r\n            }) \r\n            )\r\n        } catch {\r\n            res.send( res.status(404).json({\r\n                status:404,\r\n                error:\"Account doesn't exist!\",\r\n            }) \r\n            )\r\n        }\r\n    }\r\n}\r\nmodule.exports=authController;"],"mappings":"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"}