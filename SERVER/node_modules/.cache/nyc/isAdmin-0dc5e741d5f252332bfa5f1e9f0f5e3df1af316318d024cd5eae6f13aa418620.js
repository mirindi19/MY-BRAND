function cov_8f66debwe(){var path="E:\\andela\\New Andela\\node_mongo_tutorial\\src\\middlewares\\isAdmin.js";var hash="fe88a5d6d07620d56795700c0a47dbe642b4c597";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"E:\\andela\\New Andela\\node_mongo_tutorial\\src\\middlewares\\isAdmin.js",statementMap:{"0":{start:{line:1,column:12},end:{line:1,column:35}},"1":{start:{line:2,column:14},end:{line:2,column:40}},"2":{start:{line:3,column:16},end:{line:32,column:1}},"3":{start:{line:4,column:16},end:{line:4,column:36}},"4":{start:{line:5,column:2},end:{line:7,column:3}},"5":{start:{line:6,column:4},end:{line:6,column:74}},"6":{start:{line:8,column:2},end:{line:31,column:3}},"7":{start:{line:9,column:20},end:{line:9,column:67}},"8":{start:{line:10,column:4},end:{line:10,column:23}},"9":{start:{line:11,column:18},end:{line:11,column:32}},"10":{start:{line:12,column:18},end:{line:14,column:6}},"11":{start:{line:15,column:4},end:{line:20,column:5}},"12":{start:{line:16,column:6},end:{line:19,column:9}},"13":{start:{line:21,column:4},end:{line:28,column:5}},"14":{start:{line:22,column:6},end:{line:22,column:20}},"15":{start:{line:24,column:6},end:{line:27,column:9}},"16":{start:{line:30,column:4},end:{line:30,column:49}},"17":{start:{line:33,column:0},end:{line:33,column:25}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:3,column:16},end:{line:3,column:17}},loc:{start:{line:3,column:42},end:{line:32,column:1}},line:3}},branchMap:{"0":{loc:{start:{line:5,column:2},end:{line:7,column:3}},type:"if",locations:[{start:{line:5,column:2},end:{line:7,column:3}},{start:{line:5,column:2},end:{line:7,column:3}}],line:5},"1":{loc:{start:{line:15,column:4},end:{line:20,column:5}},type:"if",locations:[{start:{line:15,column:4},end:{line:20,column:5}},{start:{line:15,column:4},end:{line:20,column:5}}],line:15},"2":{loc:{start:{line:21,column:4},end:{line:28,column:5}},type:"if",locations:[{start:{line:21,column:4},end:{line:28,column:5}},{start:{line:21,column:4},end:{line:28,column:5}}],line:21}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},inputSourceMap:{version:3,names:["jwt","require","users","isAdmin","req","res","next","Token","headers","status","send","decoded","verify","process","env","JWT_SECRET","user","email","found","findOne","json","message","role","err","module","exports"],sourceRoot:"E:\\andela\\New Andela\\node_mongo_tutorial\\src\\middlewares\\",sources:["isAdmin.js"],sourcesContent:["const jwt =require(\"jsonwebtoken\");\r\nconst users =require(\"../models/users\");\r\n\r\nconst isAdmin = async (req, res, next) => {\r\n  const Token = req.headers[\"token\"];\r\n  if (!Token) {\r\n    return res.status(403).send(\"A token is required for authentication\");\r\n  }\r\n  try {\r\n    const decoded = await jwt.verify(Token, process.env.JWT_SECRET);\r\n    req.user = decoded;\r\n   const email = req.user.email;\r\n    const found = await users.findOne({email} );\r\n    if (!found) {\r\n      return res.status(404).json({\r\n        status: 404,\r\n        message: \"User not found\",\r\n      });\r\n    }\r\n    if (found.role == \"Admin\") {\r\n      return next();\r\n    } else {\r\n      return res.status(403).json({\r\n        status: 403,\r\n        message: \"Only Admin allowed\",\r\n      });\r\n    }\r\n  } catch (err) {\r\n    return res.status(401).send(\"Invalid Token\");\r\n  }\r\n};\r\nmodule.exports=isAdmin;\r\n"],mappings:"AAAA,MAAMA,GAAG,GAAEC,OAAO,CAAC,cAAc,CAAC;AAClC,MAAMC,KAAK,GAAED,OAAO,CAAC,iBAAiB,CAAC;AAEvC,MAAME,OAAO,GAAG,OAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EACxC,MAAMC,KAAK,GAAGH,GAAG,CAACI,OAAO,CAAC,OAAO,CAAC;EAClC,IAAI,CAACD,KAAK,EAAE;IACV,OAAOF,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC,wCAAwC,CAAC;EACvE;EACA,IAAI;IACF,MAAMC,OAAO,GAAG,MAAMX,GAAG,CAACY,MAAM,CAACL,KAAK,EAAEM,OAAO,CAACC,GAAG,CAACC,UAAU,CAAC;IAC/DX,GAAG,CAACY,IAAI,GAAGL,OAAO;IACnB,MAAMM,KAAK,GAAGb,GAAG,CAACY,IAAI,CAACC,KAAK;IAC3B,MAAMC,KAAK,GAAG,MAAMhB,KAAK,CAACiB,OAAO,CAAC;MAACF;IAAK,CAAC,CAAE;IAC3C,IAAI,CAACC,KAAK,EAAE;MACV,OAAOb,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACW,IAAI,CAAC;QAC1BX,MAAM,EAAE,GAAG;QACXY,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;IACA,IAAIH,KAAK,CAACI,IAAI,IAAI,OAAO,EAAE;MACzB,OAAOhB,IAAI,EAAE;IACf,CAAC,MAAM;MACL,OAAOD,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACW,IAAI,CAAC;QAC1BX,MAAM,EAAE,GAAG;QACXY,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;EACF,CAAC,CAAC,OAAOE,GAAG,EAAE;IACZ,OAAOlB,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC,eAAe,CAAC;EAC9C;AACF,CAAC;AACDc,MAAM,CAACC,OAAO,GAACtB,OAAO"},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"fe88a5d6d07620d56795700c0a47dbe642b4c597"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_8f66debwe=function(){return actualCoverage;};}return actualCoverage;}cov_8f66debwe();const jwt=(cov_8f66debwe().s[0]++,require("jsonwebtoken"));const users=(cov_8f66debwe().s[1]++,require("../models/users"));cov_8f66debwe().s[2]++;const isAdmin=async(req,res,next)=>{cov_8f66debwe().f[0]++;const Token=(cov_8f66debwe().s[3]++,req.headers["token"]);cov_8f66debwe().s[4]++;if(!Token){cov_8f66debwe().b[0][0]++;cov_8f66debwe().s[5]++;return res.status(403).send("A token is required for authentication");}else{cov_8f66debwe().b[0][1]++;}cov_8f66debwe().s[6]++;try{const decoded=(cov_8f66debwe().s[7]++,await jwt.verify(Token,process.env.JWT_SECRET));cov_8f66debwe().s[8]++;req.user=decoded;const email=(cov_8f66debwe().s[9]++,req.user.email);const found=(cov_8f66debwe().s[10]++,await users.findOne({email}));cov_8f66debwe().s[11]++;if(!found){cov_8f66debwe().b[1][0]++;cov_8f66debwe().s[12]++;return res.status(404).json({status:404,message:"User not found"});}else{cov_8f66debwe().b[1][1]++;}cov_8f66debwe().s[13]++;if(found.role=="Admin"){cov_8f66debwe().b[2][0]++;cov_8f66debwe().s[14]++;return next();}else{cov_8f66debwe().b[2][1]++;cov_8f66debwe().s[15]++;return res.status(403).json({status:403,message:"Only Admin allowed"});}}catch(err){cov_8f66debwe().s[16]++;return res.status(401).send("Invalid Token");}};cov_8f66debwe().s[17]++;module.exports=isAdmin;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwidXNlcnMiLCJpc0FkbWluIiwicmVxIiwicmVzIiwibmV4dCIsIlRva2VuIiwiaGVhZGVycyIsInN0YXR1cyIsInNlbmQiLCJkZWNvZGVkIiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJ1c2VyIiwiZW1haWwiLCJmb3VuZCIsImZpbmRPbmUiLCJqc29uIiwibWVzc2FnZSIsInJvbGUiLCJlcnIiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJFOlxcYW5kZWxhXFxOZXcgQW5kZWxhXFxub2RlX21vbmdvX3R1dG9yaWFsXFxzcmNcXG1pZGRsZXdhcmVzXFwiLCJzb3VyY2VzIjpbImlzQWRtaW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgand0ID1yZXF1aXJlKFwianNvbndlYnRva2VuXCIpO1xyXG5jb25zdCB1c2VycyA9cmVxdWlyZShcIi4uL21vZGVscy91c2Vyc1wiKTtcclxuXHJcbmNvbnN0IGlzQWRtaW4gPSBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuICBjb25zdCBUb2tlbiA9IHJlcS5oZWFkZXJzW1widG9rZW5cIl07XHJcbiAgaWYgKCFUb2tlbikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5zZW5kKFwiQSB0b2tlbiBpcyByZXF1aXJlZCBmb3IgYXV0aGVudGljYXRpb25cIik7XHJcbiAgfVxyXG4gIHRyeSB7XHJcbiAgICBjb25zdCBkZWNvZGVkID0gYXdhaXQgand0LnZlcmlmeShUb2tlbiwgcHJvY2Vzcy5lbnYuSldUX1NFQ1JFVCk7XHJcbiAgICByZXEudXNlciA9IGRlY29kZWQ7XHJcbiAgIGNvbnN0IGVtYWlsID0gcmVxLnVzZXIuZW1haWw7XHJcbiAgICBjb25zdCBmb3VuZCA9IGF3YWl0IHVzZXJzLmZpbmRPbmUoe2VtYWlsfSApO1xyXG4gICAgaWYgKCFmb3VuZCkge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDQpLmpzb24oe1xyXG4gICAgICAgIHN0YXR1czogNDA0LFxyXG4gICAgICAgIG1lc3NhZ2U6IFwiVXNlciBub3QgZm91bmRcIixcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBpZiAoZm91bmQucm9sZSA9PSBcIkFkbWluXCIpIHtcclxuICAgICAgcmV0dXJuIG5leHQoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuanNvbih7XHJcbiAgICAgICAgc3RhdHVzOiA0MDMsXHJcbiAgICAgICAgbWVzc2FnZTogXCJPbmx5IEFkbWluIGFsbG93ZWRcIixcclxuICAgICAgfSk7XHJcbiAgICB9XHJcbiAgfSBjYXRjaCAoZXJyKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDEpLnNlbmQoXCJJbnZhbGlkIFRva2VuXCIpO1xyXG4gIH1cclxufTtcclxubW9kdWxlLmV4cG9ydHM9aXNBZG1pbjtcclxuIl0sIm1hcHBpbmdzIjoiQUFBQSxNQUFNQSxHQUFHLEdBQUVDLE9BQU8sQ0FBQyxjQUFjLENBQUM7QUFDbEMsTUFBTUMsS0FBSyxHQUFFRCxPQUFPLENBQUMsaUJBQWlCLENBQUM7QUFFdkMsTUFBTUUsT0FBTyxHQUFHLE9BQU9DLEdBQUcsRUFBRUMsR0FBRyxFQUFFQyxJQUFJLEtBQUs7RUFDeEMsTUFBTUMsS0FBSyxHQUFHSCxHQUFHLENBQUNJLE9BQU8sQ0FBQyxPQUFPLENBQUM7RUFDbEMsSUFBSSxDQUFDRCxLQUFLLEVBQUU7SUFDVixPQUFPRixHQUFHLENBQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLHdDQUF3QyxDQUFDO0VBQ3ZFO0VBQ0EsSUFBSTtJQUNGLE1BQU1DLE9BQU8sR0FBRyxNQUFNWCxHQUFHLENBQUNZLE1BQU0sQ0FBQ0wsS0FBSyxFQUFFTSxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsVUFBVSxDQUFDO0lBQy9EWCxHQUFHLENBQUNZLElBQUksR0FBR0wsT0FBTztJQUNuQixNQUFNTSxLQUFLLEdBQUdiLEdBQUcsQ0FBQ1ksSUFBSSxDQUFDQyxLQUFLO0lBQzNCLE1BQU1DLEtBQUssR0FBRyxNQUFNaEIsS0FBSyxDQUFDaUIsT0FBTyxDQUFDO01BQUNGO0lBQUssQ0FBQyxDQUFFO0lBQzNDLElBQUksQ0FBQ0MsS0FBSyxFQUFFO01BQ1YsT0FBT2IsR0FBRyxDQUFDSSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNXLElBQUksQ0FBQztRQUMxQlgsTUFBTSxFQUFFLEdBQUc7UUFDWFksT0FBTyxFQUFFO01BQ1gsQ0FBQyxDQUFDO0lBQ0o7SUFDQSxJQUFJSCxLQUFLLENBQUNJLElBQUksSUFBSSxPQUFPLEVBQUU7TUFDekIsT0FBT2hCLElBQUksRUFBRTtJQUNmLENBQUMsTUFBTTtNQUNMLE9BQU9ELEdBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDVyxJQUFJLENBQUM7UUFDMUJYLE1BQU0sRUFBRSxHQUFHO1FBQ1hZLE9BQU8sRUFBRTtNQUNYLENBQUMsQ0FBQztJQUNKO0VBQ0YsQ0FBQyxDQUFDLE9BQU9FLEdBQUcsRUFBRTtJQUNaLE9BQU9sQixHQUFHLENBQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLGVBQWUsQ0FBQztFQUM5QztBQUNGLENBQUM7QUFDRGMsTUFBTSxDQUFDQyxPQUFPLEdBQUN0QixPQUFPIn0=
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6Imd3SkFjTTtBQUFBLHlGQWROLEtBQU1BLElBQUcseUJBQUVDLE9BQU8sQ0FBQyxjQUFjLENBQUMsRUFDbEMsS0FBTUMsTUFBSyx5QkFBRUQsT0FBTyxDQUFDLGlCQUFpQixDQUFDLHlCQUV2QyxLQUFNRSxRQUFPLENBQUcsTUFBT0MsR0FBRyxDQUFFQyxHQUFHLENBQUVDLElBQUksR0FBSyx3QkFDeEMsS0FBTUMsTUFBSyx5QkFBR0gsR0FBRyxDQUFDSSxPQUFPLENBQUMsT0FBTyxDQUFDLHlCQUNsQyxHQUFJLENBQUNELEtBQUssQ0FBRSxrREFDVixNQUFPRixJQUFHLENBQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLHdDQUF3QyxDQUFDLENBQ3ZFLHdEQUNBLEdBQUksQ0FDRixLQUFNQyxRQUFPLHlCQUFHLEtBQU1YLElBQUcsQ0FBQ1ksTUFBTSxDQUFDTCxLQUFLLENBQUVNLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxVQUFVLENBQUMseUJBQy9EWCxHQUFHLENBQUNZLElBQUksQ0FBR0wsT0FBTyxDQUNuQixLQUFNTSxNQUFLLHlCQUFHYixHQUFHLENBQUNZLElBQUksQ0FBQ0MsS0FBSyxFQUMzQixLQUFNQyxNQUFLLDBCQUFHLEtBQU1oQixNQUFLLENBQUNpQixPQUFPLENBQUMsQ0FBQ0YsS0FBSyxDQUFDLENBQUUsMEJBQzNDLEdBQUksQ0FBQ0MsS0FBSyxDQUFFLG1EQUNWLE1BQU9iLElBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDVyxJQUFJLENBQUMsQ0FDMUJYLE1BQU0sQ0FBRSxHQUFHLENBQ1hZLE9BQU8sQ0FBRSxnQkFDWCxDQUFDLENBQUMsQ0FDSix5REFDQSxHQUFJSCxLQUFLLENBQUNJLElBQUksRUFBSSxPQUFPLENBQUUsbURBQ3pCLE1BQU9oQixLQUFJLEVBQUUsQ0FDZixDQUFDLElBQU0sbURBQ0wsTUFBT0QsSUFBRyxDQUFDSSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNXLElBQUksQ0FBQyxDQUMxQlgsTUFBTSxDQUFFLEdBQUcsQ0FDWFksT0FBTyxDQUFFLG9CQUNYLENBQUMsQ0FBQyxDQUNKLENBQ0YsQ0FBRSxNQUFPRSxHQUFHLENBQUUseUJBQ1osTUFBT2xCLElBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQzlDLENBQ0YsQ0FBQyx5QkFDRGMsTUFBTSxDQUFDQyxPQUFPLENBQUN0QixPQUFPIiwibmFtZXMiOlsiand0IiwicmVxdWlyZSIsInVzZXJzIiwiaXNBZG1pbiIsInJlcSIsInJlcyIsIm5leHQiLCJUb2tlbiIsImhlYWRlcnMiLCJzdGF0dXMiLCJzZW5kIiwiZGVjb2RlZCIsInZlcmlmeSIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUIiwidXNlciIsImVtYWlsIiwiZm91bmQiLCJmaW5kT25lIiwianNvbiIsIm1lc3NhZ2UiLCJyb2xlIiwiZXJyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRTpcXGFuZGVsYVxcTmV3IEFuZGVsYVxcbm9kZV9tb25nb190dXRvcmlhbFxcc3JjXFxtaWRkbGV3YXJlc1xcIiwic291cmNlcyI6WyJpc0FkbWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGp3dCA9cmVxdWlyZShcImpzb253ZWJ0b2tlblwiKTtcclxuY29uc3QgdXNlcnMgPXJlcXVpcmUoXCIuLi9tb2RlbHMvdXNlcnNcIik7XHJcblxyXG5jb25zdCBpc0FkbWluID0gYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcbiAgY29uc3QgVG9rZW4gPSByZXEuaGVhZGVyc1tcInRva2VuXCJdO1xyXG4gIGlmICghVG9rZW4pIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuc2VuZChcIkEgdG9rZW4gaXMgcmVxdWlyZWQgZm9yIGF1dGhlbnRpY2F0aW9uXCIpO1xyXG4gIH1cclxuICB0cnkge1xyXG4gICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IGp3dC52ZXJpZnkoVG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xyXG4gICAgcmVxLnVzZXIgPSBkZWNvZGVkO1xyXG4gICBjb25zdCBlbWFpbCA9IHJlcS51c2VyLmVtYWlsO1xyXG4gICAgY29uc3QgZm91bmQgPSBhd2FpdCB1c2Vycy5maW5kT25lKHtlbWFpbH0gKTtcclxuICAgIGlmICghZm91bmQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICBzdGF0dXM6IDQwNCxcclxuICAgICAgICBtZXNzYWdlOiBcIlVzZXIgbm90IGZvdW5kXCIsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKGZvdW5kLnJvbGUgPT0gXCJBZG1pblwiKSB7XHJcbiAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xyXG4gICAgICAgIHN0YXR1czogNDAzLFxyXG4gICAgICAgIG1lc3NhZ2U6IFwiT25seSBBZG1pbiBhbGxvd2VkXCIsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKFwiSW52YWxpZCBUb2tlblwiKTtcclxuICB9XHJcbn07XHJcbm1vZHVsZS5leHBvcnRzPWlzQWRtaW47XHJcbiJdfQ==