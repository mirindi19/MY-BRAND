function cov_8f66debwe(){var path="E:\\andela\\New Andela\\node_mongo_tutorial\\src\\middlewares\\isAdmin.js";var hash="b02354dac994c44988f90276090490b026e8723a";var global=new Function("return this")();var gcv="__coverage__";var coverageData={path:"E:\\andela\\New Andela\\node_mongo_tutorial\\src\\middlewares\\isAdmin.js",statementMap:{"0":{start:{line:1,column:12},end:{line:1,column:35}},"1":{start:{line:2,column:14},end:{line:2,column:40}},"2":{start:{line:3,column:16},end:{line:60,column:1}},"3":{start:{line:4,column:16},end:{line:4,column:31}},"4":{start:{line:33,column:2},end:{line:35,column:3}},"5":{start:{line:34,column:4},end:{line:34,column:74}},"6":{start:{line:36,column:2},end:{line:59,column:3}},"7":{start:{line:37,column:20},end:{line:37,column:67}},"8":{start:{line:38,column:4},end:{line:38,column:23}},"9":{start:{line:39,column:18},end:{line:39,column:32}},"10":{start:{line:40,column:18},end:{line:42,column:6}},"11":{start:{line:43,column:4},end:{line:48,column:5}},"12":{start:{line:44,column:6},end:{line:47,column:9}},"13":{start:{line:49,column:4},end:{line:56,column:5}},"14":{start:{line:50,column:6},end:{line:50,column:20}},"15":{start:{line:52,column:6},end:{line:55,column:9}},"16":{start:{line:58,column:4},end:{line:58,column:49}},"17":{start:{line:61,column:0},end:{line:61,column:25}}},fnMap:{"0":{name:"(anonymous_0)",decl:{start:{line:3,column:16},end:{line:3,column:17}},loc:{start:{line:3,column:42},end:{line:60,column:1}},line:3}},branchMap:{"0":{loc:{start:{line:33,column:2},end:{line:35,column:3}},type:"if",locations:[{start:{line:33,column:2},end:{line:35,column:3}},{start:{line:33,column:2},end:{line:35,column:3}}],line:33},"1":{loc:{start:{line:43,column:4},end:{line:48,column:5}},type:"if",locations:[{start:{line:43,column:4},end:{line:48,column:5}},{start:{line:43,column:4},end:{line:48,column:5}}],line:43},"2":{loc:{start:{line:49,column:4},end:{line:56,column:5}},type:"if",locations:[{start:{line:49,column:4},end:{line:56,column:5}},{start:{line:49,column:4},end:{line:56,column:5}}],line:49}},s:{"0":0,"1":0,"2":0,"3":0,"4":0,"5":0,"6":0,"7":0,"8":0,"9":0,"10":0,"11":0,"12":0,"13":0,"14":0,"15":0,"16":0,"17":0},f:{"0":0},b:{"0":[0,0],"1":[0,0],"2":[0,0]},inputSourceMap:{version:3,names:["jwt","require","users","isAdmin","req","res","next","Token","cookies","status","send","decoded","verify","process","env","JWT_SECRET","user","email","found","findOne","json","message","role","err","module","exports"],sourceRoot:"E:\\andela\\New Andela\\node_mongo_tutorial\\src\\middlewares\\",sources:["isAdmin.js"],sourcesContent:["const jwt =require(\"jsonwebtoken\");\r\nconst users =require(\"../models/users\");\r\n\r\nconst isAdmin = async (req, res, next) => {\r\n\r\n  const Token = req.cookies.jwt\r\n//   if(token){\r\n//       jwt.verify(token,'mirinditokensecrete',async(err,decodedtoken)=>{\r\n//           if(err){\r\n//               res.status(400).json({\"message\":err})\r\n//   // next()\r\n//           }\r\n//           if(decodedtoken){\r\n//               const data= await users.findById(decodedtoken.id)\r\n//               res.status(200).json({\r\n//                 data:token\r\n//               })\r\n//               // if(data){\r\n//               //    if(data.email==\"admin@gmail.com\"){\r\n//               //     next()\r\n//               //    }\r\n//               //    else{\r\n//               //     res.status(400).json({\"message\":\"Only Admin can perform this action\"})\r\n//               //    }\r\n//               // }else{\r\n//               //     res.status(400).json({\"message\":\"user not found\"})\r\n//               // }\r\n//           }\r\n//       })\r\n//   }else{\r\n//       res.status(401).json({\"message\":\"Log In first !!\"})\r\n// }\r\n\r\n  // const Token = req.headers[\"token\"];\r\n  if (!Token) {\r\n    return res.status(403).send(\"A token is required for authentication\");\r\n  }\r\n  try {\r\n    const decoded = await jwt.verify(Token, process.env.JWT_SECRET);\r\n    req.user = decoded;\r\n   const email = req.user.email;\r\n    const found = await users.findOne({email} );\r\n    if (!found) {\r\n      return res.status(404).json({\r\n        status: 404,\r\n        message: \"User not found\",\r\n      });\r\n    }\r\n    if (found.role == \"Admin\") {\r\n      return next();\r\n    } else {\r\n      return res.status(403).json({\r\n        status: 403,\r\n        message: \"Only Admin allowed\",\r\n      });\r\n    }\r\n  } catch (err) {\r\n    return res.status(401).send(\"Invalid Token\");\r\n  }\r\n};\r\nmodule.exports=isAdmin;\r\n"],mappings:"AAAA,MAAMA,GAAG,GAAEC,OAAO,CAAC,cAAc,CAAC;AAClC,MAAMC,KAAK,GAAED,OAAO,CAAC,iBAAiB,CAAC;AAEvC,MAAME,OAAO,GAAG,OAAOC,GAAG,EAAEC,GAAG,EAAEC,IAAI,KAAK;EAExC,MAAMC,KAAK,GAAGH,GAAG,CAACI,OAAO,CAACR,GAAG;EAC/B;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;EACA;;EAEE;EACA,IAAI,CAACO,KAAK,EAAE;IACV,OAAOF,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC,wCAAwC,CAAC;EACvE;EACA,IAAI;IACF,MAAMC,OAAO,GAAG,MAAMX,GAAG,CAACY,MAAM,CAACL,KAAK,EAAEM,OAAO,CAACC,GAAG,CAACC,UAAU,CAAC;IAC/DX,GAAG,CAACY,IAAI,GAAGL,OAAO;IACnB,MAAMM,KAAK,GAAGb,GAAG,CAACY,IAAI,CAACC,KAAK;IAC3B,MAAMC,KAAK,GAAG,MAAMhB,KAAK,CAACiB,OAAO,CAAC;MAACF;IAAK,CAAC,CAAE;IAC3C,IAAI,CAACC,KAAK,EAAE;MACV,OAAOb,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACW,IAAI,CAAC;QAC1BX,MAAM,EAAE,GAAG;QACXY,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;IACA,IAAIH,KAAK,CAACI,IAAI,IAAI,OAAO,EAAE;MACzB,OAAOhB,IAAI,EAAE;IACf,CAAC,MAAM;MACL,OAAOD,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACW,IAAI,CAAC;QAC1BX,MAAM,EAAE,GAAG;QACXY,OAAO,EAAE;MACX,CAAC,CAAC;IACJ;EACF,CAAC,CAAC,OAAOE,GAAG,EAAE;IACZ,OAAOlB,GAAG,CAACI,MAAM,CAAC,GAAG,CAAC,CAACC,IAAI,CAAC,eAAe,CAAC;EAC9C;AACF,CAAC;AACDc,MAAM,CAACC,OAAO,GAACtB,OAAO"},_coverageSchema:"1a1c01bbd47fc00a2c39e90264f33305004495a9",hash:"b02354dac994c44988f90276090490b026e8723a"};var coverage=global[gcv]||(global[gcv]={});if(!coverage[path]||coverage[path].hash!==hash){coverage[path]=coverageData;}var actualCoverage=coverage[path];{// @ts-ignore
cov_8f66debwe=function(){return actualCoverage;};}return actualCoverage;}cov_8f66debwe();const jwt=(cov_8f66debwe().s[0]++,require("jsonwebtoken"));const users=(cov_8f66debwe().s[1]++,require("../models/users"));cov_8f66debwe().s[2]++;const isAdmin=async(req,res,next)=>{cov_8f66debwe().f[0]++;const Token=(cov_8f66debwe().s[3]++,req.cookies.jwt);//   if(token){
//       jwt.verify(token,'mirinditokensecrete',async(err,decodedtoken)=>{
//           if(err){
//               res.status(400).json({"message":err})
//   // next()
//           }
//           if(decodedtoken){
//               const data= await users.findById(decodedtoken.id)
//               res.status(200).json({
//                 data:token
//               })
//               // if(data){
//               //    if(data.email=="admin@gmail.com"){
//               //     next()
//               //    }
//               //    else{
//               //     res.status(400).json({"message":"Only Admin can perform this action"})
//               //    }
//               // }else{
//               //     res.status(400).json({"message":"user not found"})
//               // }
//           }
//       })
//   }else{
//       res.status(401).json({"message":"Log In first !!"})
// }
// const Token = req.headers["token"];
cov_8f66debwe().s[4]++;if(!Token){cov_8f66debwe().b[0][0]++;cov_8f66debwe().s[5]++;return res.status(403).send("A token is required for authentication");}else{cov_8f66debwe().b[0][1]++;}cov_8f66debwe().s[6]++;try{const decoded=(cov_8f66debwe().s[7]++,await jwt.verify(Token,process.env.JWT_SECRET));cov_8f66debwe().s[8]++;req.user=decoded;const email=(cov_8f66debwe().s[9]++,req.user.email);const found=(cov_8f66debwe().s[10]++,await users.findOne({email}));cov_8f66debwe().s[11]++;if(!found){cov_8f66debwe().b[1][0]++;cov_8f66debwe().s[12]++;return res.status(404).json({status:404,message:"User not found"});}else{cov_8f66debwe().b[1][1]++;}cov_8f66debwe().s[13]++;if(found.role=="Admin"){cov_8f66debwe().b[2][0]++;cov_8f66debwe().s[14]++;return next();}else{cov_8f66debwe().b[2][1]++;cov_8f66debwe().s[15]++;return res.status(403).json({status:403,message:"Only Admin allowed"});}}catch(err){cov_8f66debwe().s[16]++;return res.status(401).send("Invalid Token");}};cov_8f66debwe().s[17]++;module.exports=isAdmin;//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJqd3QiLCJyZXF1aXJlIiwidXNlcnMiLCJpc0FkbWluIiwicmVxIiwicmVzIiwibmV4dCIsIlRva2VuIiwiY29va2llcyIsInN0YXR1cyIsInNlbmQiLCJkZWNvZGVkIiwidmVyaWZ5IiwicHJvY2VzcyIsImVudiIsIkpXVF9TRUNSRVQiLCJ1c2VyIiwiZW1haWwiLCJmb3VuZCIsImZpbmRPbmUiLCJqc29uIiwibWVzc2FnZSIsInJvbGUiLCJlcnIiLCJtb2R1bGUiLCJleHBvcnRzIl0sInNvdXJjZVJvb3QiOiJFOlxcYW5kZWxhXFxOZXcgQW5kZWxhXFxub2RlX21vbmdvX3R1dG9yaWFsXFxzcmNcXG1pZGRsZXdhcmVzXFwiLCJzb3VyY2VzIjpbImlzQWRtaW4uanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3Qgand0ID1yZXF1aXJlKFwianNvbndlYnRva2VuXCIpO1xyXG5jb25zdCB1c2VycyA9cmVxdWlyZShcIi4uL21vZGVscy91c2Vyc1wiKTtcclxuXHJcbmNvbnN0IGlzQWRtaW4gPSBhc3luYyAocmVxLCByZXMsIG5leHQpID0+IHtcclxuXHJcbiAgY29uc3QgVG9rZW4gPSByZXEuY29va2llcy5qd3RcclxuLy8gICBpZih0b2tlbil7XHJcbi8vICAgICAgIGp3dC52ZXJpZnkodG9rZW4sJ21pcmluZGl0b2tlbnNlY3JldGUnLGFzeW5jKGVycixkZWNvZGVkdG9rZW4pPT57XHJcbi8vICAgICAgICAgICBpZihlcnIpe1xyXG4vLyAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcIm1lc3NhZ2VcIjplcnJ9KVxyXG4vLyAgIC8vIG5leHQoKVxyXG4vLyAgICAgICAgICAgfVxyXG4vLyAgICAgICAgICAgaWYoZGVjb2RlZHRva2VuKXtcclxuLy8gICAgICAgICAgICAgICBjb25zdCBkYXRhPSBhd2FpdCB1c2Vycy5maW5kQnlJZChkZWNvZGVkdG9rZW4uaWQpXHJcbi8vICAgICAgICAgICAgICAgcmVzLnN0YXR1cygyMDApLmpzb24oe1xyXG4vLyAgICAgICAgICAgICAgICAgZGF0YTp0b2tlblxyXG4vLyAgICAgICAgICAgICAgIH0pXHJcbi8vICAgICAgICAgICAgICAgLy8gaWYoZGF0YSl7XHJcbi8vICAgICAgICAgICAgICAgLy8gICAgaWYoZGF0YS5lbWFpbD09XCJhZG1pbkBnbWFpbC5jb21cIil7XHJcbi8vICAgICAgICAgICAgICAgLy8gICAgIG5leHQoKVxyXG4vLyAgICAgICAgICAgICAgIC8vICAgIH1cclxuLy8gICAgICAgICAgICAgICAvLyAgICBlbHNle1xyXG4vLyAgICAgICAgICAgICAgIC8vICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XCJtZXNzYWdlXCI6XCJPbmx5IEFkbWluIGNhbiBwZXJmb3JtIHRoaXMgYWN0aW9uXCJ9KVxyXG4vLyAgICAgICAgICAgICAgIC8vICAgIH1cclxuLy8gICAgICAgICAgICAgICAvLyB9ZWxzZXtcclxuLy8gICAgICAgICAgICAgICAvLyAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1wibWVzc2FnZVwiOlwidXNlciBub3QgZm91bmRcIn0pXHJcbi8vICAgICAgICAgICAgICAgLy8gfVxyXG4vLyAgICAgICAgICAgfVxyXG4vLyAgICAgICB9KVxyXG4vLyAgIH1lbHNle1xyXG4vLyAgICAgICByZXMuc3RhdHVzKDQwMSkuanNvbih7XCJtZXNzYWdlXCI6XCJMb2cgSW4gZmlyc3QgISFcIn0pXHJcbi8vIH1cclxuXHJcbiAgLy8gY29uc3QgVG9rZW4gPSByZXEuaGVhZGVyc1tcInRva2VuXCJdO1xyXG4gIGlmICghVG9rZW4pIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMykuc2VuZChcIkEgdG9rZW4gaXMgcmVxdWlyZWQgZm9yIGF1dGhlbnRpY2F0aW9uXCIpO1xyXG4gIH1cclxuICB0cnkge1xyXG4gICAgY29uc3QgZGVjb2RlZCA9IGF3YWl0IGp3dC52ZXJpZnkoVG9rZW4sIHByb2Nlc3MuZW52LkpXVF9TRUNSRVQpO1xyXG4gICAgcmVxLnVzZXIgPSBkZWNvZGVkO1xyXG4gICBjb25zdCBlbWFpbCA9IHJlcS51c2VyLmVtYWlsO1xyXG4gICAgY29uc3QgZm91bmQgPSBhd2FpdCB1c2Vycy5maW5kT25lKHtlbWFpbH0gKTtcclxuICAgIGlmICghZm91bmQpIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDA0KS5qc29uKHtcclxuICAgICAgICBzdGF0dXM6IDQwNCxcclxuICAgICAgICBtZXNzYWdlOiBcIlVzZXIgbm90IGZvdW5kXCIsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgaWYgKGZvdW5kLnJvbGUgPT0gXCJBZG1pblwiKSB7XHJcbiAgICAgIHJldHVybiBuZXh0KCk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLmpzb24oe1xyXG4gICAgICAgIHN0YXR1czogNDAzLFxyXG4gICAgICAgIG1lc3NhZ2U6IFwiT25seSBBZG1pbiBhbGxvd2VkXCIsXHJcbiAgICAgIH0pO1xyXG4gICAgfVxyXG4gIH0gY2F0Y2ggKGVycikge1xyXG4gICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAxKS5zZW5kKFwiSW52YWxpZCBUb2tlblwiKTtcclxuICB9XHJcbn07XHJcbm1vZHVsZS5leHBvcnRzPWlzQWRtaW47XHJcbiJdLCJtYXBwaW5ncyI6IkFBQUEsTUFBTUEsR0FBRyxHQUFFQyxPQUFPLENBQUMsY0FBYyxDQUFDO0FBQ2xDLE1BQU1DLEtBQUssR0FBRUQsT0FBTyxDQUFDLGlCQUFpQixDQUFDO0FBRXZDLE1BQU1FLE9BQU8sR0FBRyxPQUFPQyxHQUFHLEVBQUVDLEdBQUcsRUFBRUMsSUFBSSxLQUFLO0VBRXhDLE1BQU1DLEtBQUssR0FBR0gsR0FBRyxDQUFDSSxPQUFPLENBQUNSLEdBQUc7RUFDL0I7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7RUFFRTtFQUNBLElBQUksQ0FBQ08sS0FBSyxFQUFFO0lBQ1YsT0FBT0YsR0FBRyxDQUFDSSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyx3Q0FBd0MsQ0FBQztFQUN2RTtFQUNBLElBQUk7SUFDRixNQUFNQyxPQUFPLEdBQUcsTUFBTVgsR0FBRyxDQUFDWSxNQUFNLENBQUNMLEtBQUssRUFBRU0sT0FBTyxDQUFDQyxHQUFHLENBQUNDLFVBQVUsQ0FBQztJQUMvRFgsR0FBRyxDQUFDWSxJQUFJLEdBQUdMLE9BQU87SUFDbkIsTUFBTU0sS0FBSyxHQUFHYixHQUFHLENBQUNZLElBQUksQ0FBQ0MsS0FBSztJQUMzQixNQUFNQyxLQUFLLEdBQUcsTUFBTWhCLEtBQUssQ0FBQ2lCLE9BQU8sQ0FBQztNQUFDRjtJQUFLLENBQUMsQ0FBRTtJQUMzQyxJQUFJLENBQUNDLEtBQUssRUFBRTtNQUNWLE9BQU9iLEdBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDVyxJQUFJLENBQUM7UUFDMUJYLE1BQU0sRUFBRSxHQUFHO1FBQ1hZLE9BQU8sRUFBRTtNQUNYLENBQUMsQ0FBQztJQUNKO0lBQ0EsSUFBSUgsS0FBSyxDQUFDSSxJQUFJLElBQUksT0FBTyxFQUFFO01BQ3pCLE9BQU9oQixJQUFJLEVBQUU7SUFDZixDQUFDLE1BQU07TUFDTCxPQUFPRCxHQUFHLENBQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ1csSUFBSSxDQUFDO1FBQzFCWCxNQUFNLEVBQUUsR0FBRztRQUNYWSxPQUFPLEVBQUU7TUFDWCxDQUFDLENBQUM7SUFDSjtFQUNGLENBQUMsQ0FBQyxPQUFPRSxHQUFHLEVBQUU7SUFDWixPQUFPbEIsR0FBRyxDQUFDSSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNDLElBQUksQ0FBQyxlQUFlLENBQUM7RUFDOUM7QUFDRixDQUFDO0FBQ0RjLE1BQU0sQ0FBQ0MsT0FBTyxHQUFDdEIsT0FBTyJ9
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJtYXBwaW5ncyI6IjA2TEFpQkE7QUFBQSx5RkFqQkEsS0FBTUEsSUFBRyx5QkFBRUMsT0FBTyxDQUFDLGNBQWMsQ0FBQyxFQUNsQyxLQUFNQyxNQUFLLHlCQUFFRCxPQUFPLENBQUMsaUJBQWlCLENBQUMseUJBRXZDLEtBQU1FLFFBQU8sQ0FBRyxNQUFPQyxHQUFHLENBQUVDLEdBQUcsQ0FBRUMsSUFBSSxHQUFLLHdCQUV4QyxLQUFNQyxNQUFLLHlCQUFHSCxHQUFHLENBQUNJLE9BQU8sQ0FBQ1IsR0FBRyxFQUMvQjtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBRUU7QUFBQSx1QkFDQSxHQUFJLENBQUNPLEtBQUssQ0FBRSxrREFDVixNQUFPRixJQUFHLENBQUNJLE1BQU0sQ0FBQyxHQUFHLENBQUMsQ0FBQ0MsSUFBSSxDQUFDLHdDQUF3QyxDQUFDLENBQ3ZFLHdEQUNBLEdBQUksQ0FDRixLQUFNQyxRQUFPLHlCQUFHLEtBQU1YLElBQUcsQ0FBQ1ksTUFBTSxDQUFDTCxLQUFLLENBQUVNLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDQyxVQUFVLENBQUMseUJBQy9EWCxHQUFHLENBQUNZLElBQUksQ0FBR0wsT0FBTyxDQUNuQixLQUFNTSxNQUFLLHlCQUFHYixHQUFHLENBQUNZLElBQUksQ0FBQ0MsS0FBSyxFQUMzQixLQUFNQyxNQUFLLDBCQUFHLEtBQU1oQixNQUFLLENBQUNpQixPQUFPLENBQUMsQ0FBQ0YsS0FBSyxDQUFDLENBQUUsMEJBQzNDLEdBQUksQ0FBQ0MsS0FBSyxDQUFFLG1EQUNWLE1BQU9iLElBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDVyxJQUFJLENBQUMsQ0FDMUJYLE1BQU0sQ0FBRSxHQUFHLENBQ1hZLE9BQU8sQ0FBRSxnQkFDWCxDQUFDLENBQUMsQ0FDSix5REFDQSxHQUFJSCxLQUFLLENBQUNJLElBQUksRUFBSSxPQUFPLENBQUUsbURBQ3pCLE1BQU9oQixLQUFJLEVBQUUsQ0FDZixDQUFDLElBQU0sbURBQ0wsTUFBT0QsSUFBRyxDQUFDSSxNQUFNLENBQUMsR0FBRyxDQUFDLENBQUNXLElBQUksQ0FBQyxDQUMxQlgsTUFBTSxDQUFFLEdBQUcsQ0FDWFksT0FBTyxDQUFFLG9CQUNYLENBQUMsQ0FBQyxDQUNKLENBQ0YsQ0FBRSxNQUFPRSxHQUFHLENBQUUseUJBQ1osTUFBT2xCLElBQUcsQ0FBQ0ksTUFBTSxDQUFDLEdBQUcsQ0FBQyxDQUFDQyxJQUFJLENBQUMsZUFBZSxDQUFDLENBQzlDLENBQ0YsQ0FBQyx5QkFDRGMsTUFBTSxDQUFDQyxPQUFPLENBQUN0QixPQUFPIiwibmFtZXMiOlsiand0IiwicmVxdWlyZSIsInVzZXJzIiwiaXNBZG1pbiIsInJlcSIsInJlcyIsIm5leHQiLCJUb2tlbiIsImNvb2tpZXMiLCJzdGF0dXMiLCJzZW5kIiwiZGVjb2RlZCIsInZlcmlmeSIsInByb2Nlc3MiLCJlbnYiLCJKV1RfU0VDUkVUIiwidXNlciIsImVtYWlsIiwiZm91bmQiLCJmaW5kT25lIiwianNvbiIsIm1lc3NhZ2UiLCJyb2xlIiwiZXJyIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJzb3VyY2VSb290IjoiRTpcXGFuZGVsYVxcTmV3IEFuZGVsYVxcbm9kZV9tb25nb190dXRvcmlhbFxcc3JjXFxtaWRkbGV3YXJlc1xcIiwic291cmNlcyI6WyJpc0FkbWluLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImNvbnN0IGp3dCA9cmVxdWlyZShcImpzb253ZWJ0b2tlblwiKTtcclxuY29uc3QgdXNlcnMgPXJlcXVpcmUoXCIuLi9tb2RlbHMvdXNlcnNcIik7XHJcblxyXG5jb25zdCBpc0FkbWluID0gYXN5bmMgKHJlcSwgcmVzLCBuZXh0KSA9PiB7XHJcblxyXG4gIGNvbnN0IFRva2VuID0gcmVxLmNvb2tpZXMuand0XHJcbi8vICAgaWYodG9rZW4pe1xyXG4vLyAgICAgICBqd3QudmVyaWZ5KHRva2VuLCdtaXJpbmRpdG9rZW5zZWNyZXRlJyxhc3luYyhlcnIsZGVjb2RlZHRva2VuKT0+e1xyXG4vLyAgICAgICAgICAgaWYoZXJyKXtcclxuLy8gICAgICAgICAgICAgICByZXMuc3RhdHVzKDQwMCkuanNvbih7XCJtZXNzYWdlXCI6ZXJyfSlcclxuLy8gICAvLyBuZXh0KClcclxuLy8gICAgICAgICAgIH1cclxuLy8gICAgICAgICAgIGlmKGRlY29kZWR0b2tlbil7XHJcbi8vICAgICAgICAgICAgICAgY29uc3QgZGF0YT0gYXdhaXQgdXNlcnMuZmluZEJ5SWQoZGVjb2RlZHRva2VuLmlkKVxyXG4vLyAgICAgICAgICAgICAgIHJlcy5zdGF0dXMoMjAwKS5qc29uKHtcclxuLy8gICAgICAgICAgICAgICAgIGRhdGE6dG9rZW5cclxuLy8gICAgICAgICAgICAgICB9KVxyXG4vLyAgICAgICAgICAgICAgIC8vIGlmKGRhdGEpe1xyXG4vLyAgICAgICAgICAgICAgIC8vICAgIGlmKGRhdGEuZW1haWw9PVwiYWRtaW5AZ21haWwuY29tXCIpe1xyXG4vLyAgICAgICAgICAgICAgIC8vICAgICBuZXh0KClcclxuLy8gICAgICAgICAgICAgICAvLyAgICB9XHJcbi8vICAgICAgICAgICAgICAgLy8gICAgZWxzZXtcclxuLy8gICAgICAgICAgICAgICAvLyAgICAgcmVzLnN0YXR1cyg0MDApLmpzb24oe1wibWVzc2FnZVwiOlwiT25seSBBZG1pbiBjYW4gcGVyZm9ybSB0aGlzIGFjdGlvblwifSlcclxuLy8gICAgICAgICAgICAgICAvLyAgICB9XHJcbi8vICAgICAgICAgICAgICAgLy8gfWVsc2V7XHJcbi8vICAgICAgICAgICAgICAgLy8gICAgIHJlcy5zdGF0dXMoNDAwKS5qc29uKHtcIm1lc3NhZ2VcIjpcInVzZXIgbm90IGZvdW5kXCJ9KVxyXG4vLyAgICAgICAgICAgICAgIC8vIH1cclxuLy8gICAgICAgICAgIH1cclxuLy8gICAgICAgfSlcclxuLy8gICB9ZWxzZXtcclxuLy8gICAgICAgcmVzLnN0YXR1cyg0MDEpLmpzb24oe1wibWVzc2FnZVwiOlwiTG9nIEluIGZpcnN0ICEhXCJ9KVxyXG4vLyB9XHJcblxyXG4gIC8vIGNvbnN0IFRva2VuID0gcmVxLmhlYWRlcnNbXCJ0b2tlblwiXTtcclxuICBpZiAoIVRva2VuKSB7XHJcbiAgICByZXR1cm4gcmVzLnN0YXR1cyg0MDMpLnNlbmQoXCJBIHRva2VuIGlzIHJlcXVpcmVkIGZvciBhdXRoZW50aWNhdGlvblwiKTtcclxuICB9XHJcbiAgdHJ5IHtcclxuICAgIGNvbnN0IGRlY29kZWQgPSBhd2FpdCBqd3QudmVyaWZ5KFRva2VuLCBwcm9jZXNzLmVudi5KV1RfU0VDUkVUKTtcclxuICAgIHJlcS51c2VyID0gZGVjb2RlZDtcclxuICAgY29uc3QgZW1haWwgPSByZXEudXNlci5lbWFpbDtcclxuICAgIGNvbnN0IGZvdW5kID0gYXdhaXQgdXNlcnMuZmluZE9uZSh7ZW1haWx9ICk7XHJcbiAgICBpZiAoIWZvdW5kKSB7XHJcbiAgICAgIHJldHVybiByZXMuc3RhdHVzKDQwNCkuanNvbih7XHJcbiAgICAgICAgc3RhdHVzOiA0MDQsXHJcbiAgICAgICAgbWVzc2FnZTogXCJVc2VyIG5vdCBmb3VuZFwiLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICAgIGlmIChmb3VuZC5yb2xlID09IFwiQWRtaW5cIikge1xyXG4gICAgICByZXR1cm4gbmV4dCgpO1xyXG4gICAgfSBlbHNlIHtcclxuICAgICAgcmV0dXJuIHJlcy5zdGF0dXMoNDAzKS5qc29uKHtcclxuICAgICAgICBzdGF0dXM6IDQwMyxcclxuICAgICAgICBtZXNzYWdlOiBcIk9ubHkgQWRtaW4gYWxsb3dlZFwiLFxyXG4gICAgICB9KTtcclxuICAgIH1cclxuICB9IGNhdGNoIChlcnIpIHtcclxuICAgIHJldHVybiByZXMuc3RhdHVzKDQwMSkuc2VuZChcIkludmFsaWQgVG9rZW5cIik7XHJcbiAgfVxyXG59O1xyXG5tb2R1bGUuZXhwb3J0cz1pc0FkbWluO1xyXG4iXX0=